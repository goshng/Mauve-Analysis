Mauve, Clonal Frame, Clonal Origin Analysis
===========================================

History
-------
Jobs that were done are described for later reference.

.Meaning of arrows
-> means I finished the job.
---> means I need to do something about it.

To Do
~~~~~

.alpha1, alpha2, and tau would be implemented.

.Finish works in the directory +manuscript+.

Running jobs
~~~~~~~~~~~~
Aligning sequences using Mauve
cac:Documents/Projects/m2/output/cornell4/3/run-mauve

Wed Jan 25 17:31:59 EST 2012
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
I have received a review from MBE. 
Three data sets are prepared to see if other genomes would give similar trends.
cornell1: MGAS10270, MGAS8232
cornell2: MGAS9429, MGAS10394
cornell3: MGAS6180, M1
cornell4: 8 genomes (6 at the above and the original two SPYs)

Wed Dec 14 12:54:25 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
s1 - s14 can be deleted. I copied them from cac. I may have them for a while. I
do not need them.

Thu Dec  1 11:08:27 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Example of UCSC genome track
----
chr1:510,951-514,795
----

Where are these genes?
\textit{gki}, \textit{gtr},
\textit{murI}, \textit{mutS}, \textit{recP}, and \textit{xpt}
Let's see the SPY1's genbank file.

.From Kalia2001
----
The ML tree for xpt alleles (Fig. 2) and visual examination of the polymorphic
sites (Fig. 3) do not show the clear distinction into GAS-like (cluster I) and
GCS-GGS-like (cluster II) alleles that was observed for gki, gtr, murI, mutS,
and yqiL.

The similarity of the diverged recP alleles of GAS to the most typical alleles
found among GCS and GGS suggests that they were introduced into GAS from GCS-GGS
strains.
----

We should see higher recombination in xpt and recP but not the others. 

gki -> not in the region but its neighboring
1207587-1208084
/gene="glcK"
/locus_tag="SpyM3_1180"

gtr -> no recombination 
1186522-1186073
/locus_tag="SpyM3_1160"

murI -> no recombination
303215-303652
/gene="glr"
/locus_tag="SpyM3_0262"

mutS -> a little bit
1836841-1837245
/gene="mutS.2"
/locus_tag="SpyM3_1806"

recP -> somewhat strong (consistent with Kalia2001's conclusion)
1454877-1455335
/gene="tkt"
/locus_tag="SpyM3_1462"

xpt -> somewhat strong
846784-847233
/gene="xpt"
/locus_tag="SpyM3_0794"

yqil -> no data available
131266-131699
/locus_tag="SpyM3_0108"

Wed Nov 30 11:37:23 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Backups
----
/Volumes/Elements/Documents/Projects/mauve-analysis-051111/output
----

.Virulence gene tracks
----
test/virulence
cd output/virulence
scp ucsc-virulence.sh swiftgen:/home/choi/public_html/strep-recomb
----


Mon Nov 28 21:49:11 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.To add bedDetail track
----
A line from the bed file.
chr1  232 1204  717-1 0 + 717-1 717-1

KENT=/usr/local/software/kent
hgsql $DBNAME -e "drop table fam"
hgLoadBed -bedDetail -renameSqlTable -trimSqlTable -tab -nobin -sqlTable=$KENT/src/hg/lib/bedDetail.sql $DBNAME fam $SPECIESNAME.bed

track fam 
shortLabel Gene Family
longLabel Gene Family
group genes
priority 60
visibility pack
type bedDetail 8
itemRgb on
url http://compgen.bscb.cornell.edu/~mrasmus/strep/viewtree/?famid=$$
----

Wed Nov 23 12:33:18 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.To add Matt's tracks 
----
See https://lists.soe.ucsc.edu/pipermail/genome-mirror/2011-January/002276.html
output/matt/ucsc-matt.sh
compgen:public_html/strep-recomb/ucsc-matt.sh
http://compgen.bscb.cornell.edu/~mrasmus/strep/viewtree/?famid=FAMILYID
----

.To test directly gene flow between SPY and SDE
----
bash R/obsiter.sh
----

.To test complexity hypothesis with recombination intensity measure.
----
test/go.R
----

Tue Nov 22 14:55:36 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.The p-values of testing if ratios of spy.sde to sde.spy from the posterior are greater than those
from the prior.
----
$ cat R/obsiter.R.?
The P value is 0.05594406 
The P value is 0.05619381 
The P value is 0.0521978 
The P value is 0.04170829
----

.List of genes with average posterior probability.
----
scp /Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-virulence-list-?.out swiftgen:/usr/projects/strep/gainloss/recombination/ilan/output/cornellf/3/run-analysis
swiftgen:/usr/projects/strep/gainloss/recombination/ilan/R/gene-list.R
----

.RIMAP gene files to Matt.
----
scp rimap-?-gene.txt swiftgen:/usr/projects/strep/gainloss/recombination/matt/t
----

Mon Nov 21 17:45:38 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Number of recombinant edges between SPY and SDE, and that with time constraint.

Wed Nov 16 17:44:01 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Select parts of any text using VI command `V'.
2. Push `:!bash' to execute them.
3. Push `u' to make the executed parts be reappear

Tue Nov 15 01:50:00 EST 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Need permission
----
compgen:/gbdb_cornell/SdeqGGS124/wib
compgen:/gbdb_cornell/SpyMGAS10750/wib
----

.To update the genome browser.
----
make update DBS=SdeqATCC12394
make update DBS=SddyATCC27957
make update DBS=SdeqGGS124
make update DBS=SpyMGAS10750
make update DBS=SpyMGAS315
http://choi.genome-mirror.bscb.cornell.edu

make cornell DBS=SdeqATCC12394
make cornell DBS=SddyATCC27957
make cornell DBS=SdeqGGS124
make cornell DBS=SpyMGAS10750
make cornell DBS=SpyMGAS315
http://strep-genome.bscb.cornell.edu
----

.To update cgi-bin of the genome browser
----
rsync -av --exclude "/.htaccess" --exclude="/hg.conf" /var/www/cgi-bin/ /var/www/cgi-bin-$USER/
----

Wed Nov  2 20:44:41 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cornell6 project's 2nd ClonalOrigin is submitted to the clustering. They are
waiting in the queue.


Thu Oct 27 12:27:10 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

GFF file is used to find product tags for gene descriptions.

How can I find a p-value for the heatmap? 

[1] "Greater"
        SDE1     SDE    SDE2      SD     SDD ROOT    SPY1     SPY    SPY2
SDE1 2.9e-03     NaN 1.1e-29     NaN 8.4e-21  NaN 4.2e-19     NaN 2.0e-23
SDE  1.0e+00 2.0e-06 1.0e+00     NaN 3.8e-32  NaN 8.1e-01 2.7e-08 1.0e+00
SDE2 7.9e-32     NaN 5.6e-01     NaN 1.2e-23  NaN 1.5e-17     NaN 2.9e-06
SD   1.0e+00 7.2e-01 1.0e+00 2.9e-02 6.7e-01  NaN 1.0e+00 1.0e+00 1.0e+00
SDD  1.0e+00 6.7e-32 1.0e+00     NaN 8.1e-07  NaN 1.0e+00 1.0e+00 1.0e+00
ROOT 1.0e+00 1.0e+00 1.0e+00 1.1e-33 1.0e+00  NaN 1.0e+00 1.1e-33 1.0e+00
SPY1 1.1e-33 3.4e-32 1.1e-33     NaN 1.0e+00  NaN 9.2e-01     NaN 1.1e-33
SPY  2.4e-13 2.1e-27 6.0e-32 6.8e-01 1.0e+00  NaN 1.0e+00 1.0e+00 1.0e+00
SPY2 1.1e-33 2.4e-33 1.1e-33     NaN 1.0e+00  NaN 1.1e-33     NaN 8.1e-01
[1] "Two Sided"
        SDE1     SDE    SDE2      SD     SDD ROOT    SPY1     SPY    SPY2
SDE1 3.1e-03     NaN 1.1e-29     NaN 8.8e-21  NaN 4.4e-19     NaN 2.2e-23
SDE  4.9e-02 2.3e-06 7.5e-04     NaN 3.5e-32  NaN 9.3e-01 3.0e-08 1.2e-25
SDE2 8.2e-32     NaN 6.0e-01     NaN 1.2e-23  NaN 1.6e-17     NaN 3.3e-06
SD   6.4e-11 8.0e-01 1.4e-19 3.2e-02 7.3e-01  NaN 2.2e-27 1.5e-22 1.1e-30
SDD  7.3e-33 6.7e-32 4.1e-04     NaN 9.1e-07  NaN 8.7e-34 1.8e-32 8.7e-34
ROOT 8.7e-34 8.7e-34 8.7e-34 8.7e-34 8.7e-34  NaN 8.7e-34 8.7e-34 8.7e-34
SPY1 8.7e-34 2.9e-32 8.7e-34     NaN 8.7e-34  NaN 9.3e-01     NaN 8.7e-34
SPY  2.6e-13 2.2e-27 5.8e-32 7.5e-01 8.7e-34  NaN 1.3e-03 3.9e-05 6.5e-02
SPY2 8.7e-34 2.1e-33 8.7e-34     NaN 8.7e-34  NaN 9.4e-34     NaN 9.3e-01
[1] "Less"
        SDE1     SDE    SDE2  SD     SDD ROOT    SPY1     SPY    SPY2
SDE1 1.0e+00     NaN 1.0e+00 NaN 1.0e+00  NaN 1.0e+00     NaN 1.0e+00
SDE  5.3e-02 1.0e+00 8.2e-04 NaN 1.0e+00  NaN 1.0e+00 1.0e+00 1.2e-25
SDE2 1.0e+00     NaN 1.0e+00 NaN 1.0e+00  NaN 1.0e+00     NaN 1.0e+00
SD   6.9e-11 1.0e+00 1.5e-19   1 1.0e+00  NaN 2.2e-27 1.5e-22 1.1e-30
SDD  6.4e-33 1.0e+00 4.5e-04 NaN 1.0e+00  NaN 7.1e-34 1.5e-32 7.1e-34
ROOT 7.1e-34 7.1e-34 7.1e-34   1 7.1e-34  NaN 7.1e-34 1.0e+00 7.1e-34
SPY1 1.0e+00 1.0e+00 1.0e+00 NaN 7.1e-34  NaN 1.0e+00     NaN 1.0e+00
SPY  1.0e+00 1.0e+00 1.0e+00   1 7.1e-34  NaN 1.4e-03 4.5e-05 6.9e-02
SPY2 1.0e+00 1.0e+00 1.0e+00 NaN 7.1e-34  NaN 1.0e+00     NaN 1.0e+00

.The observed value
----
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/obsonly-recedge-1.txt
/Users/goshng/Documents/Projects/Mauve/output/s18/run-analysis/obsonly-recedge.txt
/Users/goshng/Documents/Projects/Mauve/output/s18/run-analysis/obsonly-recedge.R
/Users/goshng/Documents/Projects/Mauve/output/s18/run-analysis/a
----

List of virulence genes experiencing recombination with posterior probability above 0.5. 
ri-virulence.pl is used.
Rscript R/vir-list.R > R/vir-list.R.out

Wed Oct 26 12:40:45 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ri-virulence.pl heatmap command is implemented. Two things are needed for this
command. First, we need rimap directory
----
output/cornellf/3/run-analysis/rimap-2
----
we also need an in.gene block file
----
output/cornellf/3/run-analysis/in.gene.4.block
----
The set of genes in the in.gene block file is used. We should create a subset of
genes, or virulence and non-virulence genes. We need a script to take
in.gene.4.block file and another file of the subset of genes to create an
in.gene block file for the subset.
---
output/cornellf/3/run-analysis/in.virulence.gene.4.block
output/cornellf/3/run-analysis/in.nonvirulence.gene.4.block
----

I found the virulence gene file at
----
output/virulence/virulent_genes.txt
output/virulence/virulent_genes.txt.spy1
output/cornellf/3/run-analysis/in.virulence.gene.4.block
output/cornellf/3/run-analysis/in.nonvirulence.gene.4.block
----
I find virulence gene names in +output/virulence/virulent_genes.txt+ to create
file +output/virulence/virulent_genes.txt.spy1+. Then, I create file
+output/cornellf/3/run-analysis/in.virulence.gene.4.block+
from file +output/cornellf/3/run-analysis/in.gene.4.block+.

Let's go back to +ri-virulence.pl+ script. Menu *recombination-intensity1-genes*
is used to create the following two files.
----
output/cornellf/3/run-analysis/ri-virulence-heatmap.out.nonvirulence
output/cornellf/3/run-analysis/ri-virulence-heatmap.out.virulence
----

----
> x.vir <- scan("/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-virulence-heatmap.out.virulence")
> x.vir <- x.vir / sum(x.vir)
> x.non <- scan("/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-virulence-heatmap.out.nonvirulence")
> x.non <- x.non / sum(x.non)
> write(round(x.vir/x.non, digits=3), file="a", sep="\t", ncolumns=9)
----

.To create a random virulence gene
----
perl pl/virulence.pl extract -random -in
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/in.gene.4.block
-gene output/virulence/virulent_genes.txt.spy1 -out
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/in.random.gene.4.block
----

.To create heatmap
----
perl pl/ri-virulence.pl heatmap -ri
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/rimap-2
-ingene
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/in.random.gene.4.block
-xml
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-clonalorigin/output2/2/core_co.phase3.xml
-out
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-random-heatmap.out
----

.To create heatmap for not case
----
perl pl/ri-virulence.pl heatmap -ri
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/rimap-2
-ingene
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/in.random.gene.4.block.not
-xml
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-clonalorigin/output2/2/core_co.phase3.xml
-out
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-random-heatmap.out.not
----

----
> x.vir <- scan("/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-random-heatmap.out")
> x.non <- scan("/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/ri-random-heatmap.out.not")
> write(round(x.vir/x.non, digits=3), file="a", sep="\t", ncolumns=81, append=TRUE)
----

----
$ cat x.* > x
> x <- read.table("x")
> y <- colMeans(x)
> write(round(y, digits=3), file="y", ncolumns=9, sep="\t")
----

Tue Oct 25 22:55:32 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Variance in posterior samples and s18 simulation
----
output/cornellf/3/run-analysis/obsiter-recedge-1.txt (1001)
output/cornellf/3/run-analysis/obsiter-recedge-2.txt (1001)
output/s18/run-analysis/obsonly-recedge.txt (100)
----

Let's use rimap-1.txt and rimap-2.txt to create a matrix for virulence genes and
non-virulence genes.  recombination-intensity1-genes is used.  I compute average
posterior probability per site for each pair of species tree branches. 
There is a directory rimap-1 and rimap-2. Why do we need rimap-1.txt, which
would be a combined version of rimap? 
Did I split rimap-2.txt to multiple files in rimap-2?
See menu probability-recedge-gene for getting genes with particular recedges.
Do I have create another script? ri-virulence.pl.
ri-virulence.pl is created based on recombination-intensity1-genes.pl.

FIXME: output/cornellf/3/run-analysis/rimap-1 had one missing file.
rimap-1 direcotry is not ready. How did I split rimap-1.txt file to multiple
files? 


Mon Oct 24 10:05:13 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The simulation s18 is implemented. The batch should include s18 as well as
others such as s17, and s15. The simulation s16 is similar to s18; they are
different only in the way that I replicate the genes. In simulation s16, I
created 10 recombinant trees, each of which was used to generate 10 data sets.
In simulation s18, I will create 100 recombinant trees, each of which was used
to generate a single data set. sim5-prepare was used to do simulation of s16.
sim6 is created for simulation s18. 

A recombinant tree for 274 blocks is created. 
simulate-data-clonalorigin2.sh contains some codes for creating the sequence
alignments.
simulate-data-clonalorigin2-prepare.sh contains a script that splits the single
XMFA to multiple ones.

Tue Oct 11 16:52:53 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Download xmfa2maf at the following site
----
http://gel.ahabs.wisc.edu/mauve/snapshots/
----

.Download clonalorigin
----
svn checkout http://clonalorigin.googlecode.com/svn/trunk/ clonalorigin
/Volumes/Elements/Backups/Documents/Projects/mauve/clonalorigin/gui
----

Mon Oct 10 09:52:32 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Rotate x axis.
----
http://128.97.141.26/stat/R/faq/angled_labels.htm
----

.Significancy
----
/Users/goshng/Documents/Projects/Mauve/output/email/siepel/112111
----


.Manuscript figures
----
This is this last version: /Users/goshng/Documents/Projects/Mauve/output/s17/run-analysis/posterior_predictive_check3.R
/Users/goshng/Documents/Projects/Mauve/output/s17/run-analysis/posterior_predictive_check2.R
/Users/goshng/Documents/Projects/Mauve/output/s17/run-analysis/h3-R-ratio-not-topology-changing.ps
/Users/goshng/Documents/Projects/Mauve/output/s17/run-analysis/h3-R-ratio-topology-changing.ps
----

.Time contrained count
----
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/obsonly-recedge-time-1.txt
----

Wed Oct  5 11:19:38 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Comparison of Mowgli and ClonalOrigin
----
mkdir mowgli
scp -r swiftgen:/usr/projects/strep/gainloss/recombination/fam-frag2 mowgli
see test/mowgli
----

Tue Oct  4 10:58:43 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Species tree from Mowgli analysis (branch lengths mean nothing but branch order)
----
swiftgen:/usr/projects/strep/gainloss/config/strep.div.stree
((((sde1:1,sde2:1):2,sdd:3):1,(spy1:2,spy2:2):2):1,see:5);
----

.Families and events
----
swiftgen:/usr/projects/strep/gainloss/data/fam-frag2/famid-events.txt
----

.Family sizes
----
swiftgen:/usr/projects/strep/gainloss/data/fam-frag2/famid-gene.txt
uniq -c
swiftgen:/usr/projects/strep/gainloss/config/fam-frag2.part.txt
awk '{print $1, NF-1}'
----

.Melissa's functional category test
----
RNASeq-Analysis/test/RNAz/mannwhitney.R
----

.Matt's analysis of events
----
swiftgen:/usr/projects/strep/gainloss/recombination/fam-frag2
----

.List of virulence factors associate with HGT
----
swiftgen:/usr/projects/strep/gainloss/recombination/fam-frag2/top_virulence_by_hgt_event.txt
----

Mon Oct  3 09:19:09 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.A simulation for posterior predictive checking is being done. 
. A set of 100 recombinant trees is chosen from the posterior sample. 
. Use each recombinant tree for the simulation.
. Construct the distribution for the posterior predictive checking.
. This would allow to check if the model is adequate for the data.
. Simulation number is s17 for this.

.Files that might be useful for the posterior predictive checking
----
sh/map-tree-topology.sh
pl/splitCOXMLPerIteration.pl
output/cornellf/3/run-clonalorigin/output2/ri-1
sh/simulate-data-clonalorigin2.sh
----

The directory +ri-1+ contains all of the sampled recombinant trees. The
directory contains 274,274 files: 1,001 for each block. Let's simulate data
using core_co.phase3.xml.1.11, core_co.phase3.xml.1.21, ...,
core_co.phase3.xml.1.1001. How to compile the clonalorigin of my trunk?
Search this file for cmake. Now, you know how to compile the simulation version
of clonalorigin! Use sim5-prepare to execute the wargsim. There are two possible
ways of simulating data given a recombinant tree to deal with multiple blocks:
one is to simulate the model to create data for each block, and another is to
simulate the model to create data for all of the combined blocks. When
simulating the model given a species tree I use the second approach because the
recombinant tree is created from a speices tree somewhat automatically. I am not
sure if I can the second approach for this s17 because I have to combine
multiple recombinant trees. I do not even know if clonalorigin code works that
way.

.Two ways of simulating the ClonalOrigin model to generate data
. Use a recombinant tree for each block to create a single multiple alignment.
. Use a combined recombinant tree to create multiple-multiple alignments.

I use the first approach because this can be done without combining recombinant
trees of all of the 274 blocks. Now, let's submit jobs of these to the cluster.


.A weird XMFA alignment
----
output/s17/55/data/core_alignment.253.551.1.xmfa
output/s17/55/run-clonalorigin/output2/1/core_co.phase3.xml.253
----

NOTE: I need to check the simulated alignments have any N's. Why does the simulated
alignment have N's? See the the weird XMFA file above.

s17: 10 hours with 87 computing nodes.
----
cac:run/mauve/100311
----


Thu Sep 29 01:44:20 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.To create posterior probability of recombination
----
test/recombprob/batch.sh
test/wigmaf/run
----

Wed Sep 28 18:01:27 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Check the following files for creating UCSC genome browser.

.Scripts to create UCSC genome browser for strep recombination
----
test/wigmaf/run
test/virulence/run
/Users/goshng/Documents/Projects/Peach/ucscgb
----



Wed Sep 21 11:48:18 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The recombination intensity per site should be corrected using prior. For this
one we need the length of blocks, recombination rate per site, and delta per
site. We should be able to find these values.

.Block lengths can be found at
----
output/cornellf/3/run-analysis/in.block
----

.Three parameter estimates should be found at
----
output/cornellf/3/run-clonalorigin/summary/1/median.txt
----

I need to use these to compute the prior distribution of recombination intensity
per site. This would be used to compute the ratio of posterior recombination
intensity against the prior recombination intensity. Then, we might find some
sensible genomic regions with high or low recombination intensity.
Let's have a test directory +test/riprior+ to test this.

We also want to find the alignments. The +data+ directory contains
+core_alignment.xmfa+ that needs to be converted to _wigMaf_ format so that
alignments can be loaded to UCSC genome browser.
Let's make a test directory +test/wigmaf+ to test this.

Tue Sep 20 17:28:02 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
I need three tracks for each of 5 species: recombination intensity (WIG format), 
blocks of alignment (MAF format), and virulence genes (bed format). I wonder if
I can click a bed bar to show information such as sequence alignments or
information about virulence genes. 


Sat Sep 17 12:23:26 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
I make a table where rows represent species and columns orthologous genes.

.Table of genes and the virulence
----
test/virulence/run
----


Fri Sep 16 16:21:27 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Where is the file that I sent to Melissa for functional category analyses?

.File with genes and their recombination intensity
----
emails/to/melissa/072011/rimap.gene.txt
----

Where can I find recombination intensity along SDE genome? 

.File with recombination intensity with respect to S. pyogenes MGAS315
----
output/cornellf/3/run-analysis/ri1-refgenome4-map.wig
----

Genome tracks as a resource might be worth trying. ClonalOrigin's analysis
used 5 genomes, and Mawgli's used 6 genomes. I think that still I can use the
current strep-genome tracks. First, blocks of core alignments are displayed
using BED files. 

Wed Sep  7 13:02:47 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
xmfa2maf can convert XMFA to MAF that can be read in by RNAz.

Fri Jul 22 17:10:53 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Comparison seems okay, and the number of genes has changed. There are more genes
in the more recent version or 072011.
/Users/goshng/Documents/Projects/mauve-analysis/to/mellisa/072011/rimap.gene.txt
/Users/goshng/Documents/Projects/mauve-analysis/to/mellisa/051811/ri1-refgenome4-map.gene
----
x <- read.table("mw-results.txt", header=TRUE, sep="\t")

names(x)
o.sde2spy <- order(x$p.value.sde2spy)
x[o.sde2spy,][1:10,]
x[o.sde2spy,c("gocat", "p.value.sde2spy")][1:10,]
x[o.sde2spy,c("go.description", "p.value.sde2spy")][1:10,]

o.sde2spy <- order(x$p.value.sde2spy)
pval.corr.sde2spy <- p.adjust(x$p.value.sde2spy, method="BH")
sum(pval.corr.sde2spy < 0.05)
x[o.sde2spy,c("go.description", "p.value.sde2spy")][1:11,]

o.spy2sde <- order(x$p.value.spy2sde)
pval.corr.spy2sde <- p.adjust(x$p.value.spy2sde, method="BH")
sum(pval.corr.spy2sde < 0.05)
x[o.spy2sde,c("go.description", "p.value.spy2sde")][1:9,]
----

Tue Jul 19 21:56:52 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cornellf/3/run-clonalorigin/output2/2 was not finished yet.
The second replicate of the 2nd stage of ClonalOrigin needs to be compared with
the first replicate.


Sun Jul 17 18:41:46 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
sim3-prepare is the one that I need to check for ri simulation (s16).
sim3-analyze.
analyze-run-clonalorigin2-simulation2-prepare.pl and
analyze-run-clonalorigin2-simulation2-analyze.pl are used for recombination
intensity simulation.
analyze-run-clonalorigin2-simulation2-prepare.pl is used to find ri.
analyze-run-clonalorigin2-simulation2-analyze.pl is used to combine results.
analyze-run-clonalorigin2-simulation2-analyze.pl is a simple perl script without
XML parsing.

Fri Jul 15 22:57:38 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See +pl/recombination-intensity1-map.pl+ for out and outfile.

Tue Jun 28 15:26:38 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Ilan suggested me to find the raw data of the figures for the heatmap simulation
analysis. This could be +s14+ simulation. It was +s16+ simulation.

Thu Jun  9 18:10:53 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
I am wonderig if there are ways of making scatter plots with density.

http://addictedtor.free.fr/graphiques/RGraphGallery.php?graph=139

Run the following in R to install geneplotter library.

source("http://bioconductor.org/biocLite.R")
biocLite("geneplotter")

Thu May 19 20:46:00 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Cornellf/3 2nd stage of CO (or ClonalOrigin) runs started or submitted to CAC
cluster, and the jobs are waiting in the queue.
----
cornellf/3/run-clonalorigin/output2/2
----
--->

s16's ri or sim3-prepare is submitted to CAC
---> (2 nodes)


Tue May 17 09:00:56 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.RI1 and RI2 takes 3 days roughly (cornellf/3/1).
. I am still waiting for them to finish.

.RI1 for the reference genomes of SPY1
----
/Users/goshng/Documents/Projects/mauve-analysis/output/cornellf/3/run-analysis/ri1-refgenome4-map.txt
----

.RI2 for genes of SPY1, in.gene has columns of values:
1: gene name
2: gene start position in the reference genome
3: gene end position in the reference genome
4: gene strand
5: block ID of the gene
6: gene start position in the block
7: gene end position in the block 
8: gene length
9: proportion of gaps of the gene in the alignment
10: number of changes of gene tree topology
11: number of trees that are different from the species tree
12: number of unique gene tree topologies
13: probability of experiencing gene tree topology change
----
/Users/goshng/Documents/Projects/mauve-analysis/output/cornellf/3/run-analysis/in.gene
----

Mon May 16 10:35:03 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.RI2(number of unique topologies) for genes of SPY1
----
output/cornellf/8/run-analysis/in.gene
The 12th column is the number of unique topologies per site
----
Let's do the 
menu map-tree-topology with cornellf/3/1.


Sun May 15 18:30:12 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Heatmap's ``p-value'' between simulation and real data runs
. This is a comparison between estimates from the real data sets (cornellf/8/2) and estimates
from the simulated one (s14). 
----
output/s14/run-analysis/2.R
----

Sat May 14 14:12:44 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Gene ontology analysis with functional categories
. I use cornellf/8/2 or repetition 8 and replicate 2.
. I use cornellf/3/1 or repetition 3 and replicate 1.

.The main parameter summary : Interquartile Range or IQR (using median)
. Chanaged pl/computeMedians.pl

.s16 is started
. waiting for simulation of *wargsim*
. (10 nodes) how many days? -> 3 days!

.cornellf/3's 2nd runs of ClonalOrigin's 1st stage MCMC started.
. waiting for jobs in cac, or output/cornellf/3/run-clonalorigin/output/2
. (3 nodes) how many days? ---> See them at Monday (May 16th)

.s15 is still in progress
. 1 job remained to run jobs in 2 nodes ---> See them tomorrow (May 15th)

Thu May 12 08:40:54 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Why is s12 flawed? What is the difference between s12 and s14? Their species
files are the same. 
-> I think that s12 was a simulation using XML output from the real data. All of
the recombinant trees are correlated samples from MCMC. I do not know what are
wrong in this analysis. It is not obvious to figure it out. Anyway, I should not
use s12. The simulation of s12 must have been done with menu
simulate-data-clonalorigin2-from-xml.

.s14's map topology simulation result
----
/Users/goshng/Documents/Projects/mauve-analysis/output/s14/run-analysis/mt.txt
/Users/goshng/Documents/Projects/mauve-analysis/output/s14/run-analysis/mt.R.ps
----

Wed May 11 14:53:02 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Cornellf/3
^^^^^^^^^^

.The species tree from clonal frame analysis
----
output/cornellf/3/run-clonalframe/output/1/core_clonalframe.out.1
----

.heatmap
----
http://enotacoes.wordpress.com/2007/11/16/easy-guide-to-drawing-heat-maps-to-pdf-with-r-with-color-key/
----




Tue May 10 08:34:26 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

s14's ri and mt are under analysis
-> ri.txt
Menu analyze-run-clonalorigin2-simulation2-analyze generates ri.txt.

Menu clonalorigin2-simulation3
-> mt.txt

Check this file:
.s14's mt analysis result for genes:
----
/Users/goshng/Documents/Projects/mauve-analysis/output/s14/run-analysis/mt.txt
----


Look at in.gene.R.ps for the distribution of tree topology.

.cornllf/8/2's mt analysis
----
output/cornellf/8/run-analysis/in.gene
output/cornellf/8/run-analysis/in.gene.R.ps
----


Mon May  9 15:13:08 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
s14's mt: map-tree-topology was being checked with simulation s14. wargsim was
slow becuase of random values from system. I did not need a random number for
finding topology. I turned it off. Otherwise, wargsim was unpredictably slow
because it waited for the random seed generation from system.
-> done in 1 hour with 10 nodes (menu clonalorigin2-simulation3-prepare).
.  
---> (menu clonalorigin2-simulation3-analyze).

.An exammple file: REPETITION=1, REPLICATE=2, BLOCK=3, SAMPLE=4
----
output/s14/1/run-clonalorigin/output2/mt-2-out/core_co.phase3.xml.3.4
----

.A true mt file: REPETITION=1, BLOCK=2, (SAMPLE=1 A single sample in true)
----
output/s14/1/run-analysis/mt-yes-out/core_co.phase3.xml.2.1
----

.s14's mt analysis result for genes:
----
/Users/goshng/Documents/Projects/mauve-analysis/output/s14/run-analysis/mt.txt
----
--->



s14's ri: 
-> done in 3 hours with 10 nodes. 
(menu analyze-run-clonalorigin2-simulation2-prepare)

--->
(menu analyze-run-clonalorigin2-simulation2-analyze)

.An example file: REPETITION=5, REPLICATE=10, BLOCK=1
----
output/s14/5/run-clonalorigin/output2/ri-10/1
----

.True XML file: REPETITION=1, BLOCK=2
----
output/s14/1/data/core_alignment.xml.2
----

.An example file for a true: REPETITION=1, BLOCK=2
----
output/s14/1/run-analysis/ri-true/2
----

.Table
----
gene true estimate
----

.Figure for s14 with ri analysis
/Users/goshng/Documents/Projects/mauve-analysis/output/s14/run-analysis/ri.R.ps




Sun May  8 00:59:12 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.CMakeLists.txt can be changed to compile wargsim at CAC cluster.
----
include_directories(/cac/contrib/gsl-1.12/include)
set(LIBS ${LIBS} /cac/contrib/gsl-1.12/lib/libgsl.a /cac/contrib/gsl-1.12/lib/libgslcblas.a)
----

.M3 genes annotation is used in s14
----
cp output/cornellf/8/run-analysis/in.gene output/s14/run-analysis/
----


Fri May  6 09:18:41 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Meeting with Melissa:
1. p-Values by comparing R tilde and R hat.
2. Genes with gaps. Summary of the alignment. Proportion of gaps.
-> done in menu locate-gene-in-block
3. Average number of tree topology changes within a gene.
--->
4. Boundary effect on true RI and its estimates.
-> This is possible concern because the first site of a block would have higher
number of recombinant edges.
5. Gene length, block length effects. Gene locations effect.




Thu May  5 10:02:46 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

s11's recombination intensity
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.An output file for recombination intensity
----
output/s11/run-analysis/ri.txt
----

Wed May  4 13:52:05 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

s10, s11, s13 will be used for testing recombination intesnity. What is a better
name for recombination intensity? 

s10's recombination intensity
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.The true recombinant tree
. output/s10/1/data/core_alignment.xml.1 

.The 100 simulated sequence data given the true recombinant tree
. output/s10/1/data/core_alignment.1.xmfa.1   

.The 100 clonal origin XML files
. output/s10/1/run-clonalorigin/output2/1/core_co.phase3.xml.1

pl/recombination-intensity4.pl is the current perl script that extracts
recombination intensity. I could use that.

.Perl script of checking simulation for recombination intensity
----
cp pl/recombination-intensity4.pl pl/analyze-run-clonalorigin2-simulation2.pl
----

.An output file for recombination intensity
----
output/s10/run-analysis/ri.txt
----

results of s10's RI simulation
-> output/s10/run-analysis/ri.R.out
True/Estimate/Degree of Over- or Under-estimate


Map Topology Change
^^^^^^^^^^^^^^^^^^^
map-tree-topology menu is almost working:
output/cornellf/8/run-clonalorigin/output2/2 is used as a test.
---> not yet.

To Do for map-tree-topology menu:
1. Combine ri-2-out's files for a block.
2. Analyze those files with a perl script.
--->


Tue May  3 11:49:25 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.An interesting software for tree comparison and enumeration:
---
http://taxonomy.zoology.gla.ac.uk/rod/cplite/Manual.html
---

Mon May  2 13:48:07 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

compute-heatmap-recedge.pl is more efficient than other extract...pl perl
scripts.

Sat Apr 30 11:26:14 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

s14's analysis is similar to s12's except that recombinant trees are random.
-> done of ClonalOrigin2 in 2 days
-> output/s14/run-analysis/1.R.out
-> output/s14/run-analysis/2.R.out
This appears to show that I observed before (SPY -> SDE).

Fri Apr 29 13:54:44 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

s13's analysis is being analyzed. This is the same analysis as s11 except the
block configuration. I have two purposes: one for checking as s11, and another
for comparing the simulation result with the real data. The simulation results
can be similar to the prior count. I wish to extract any effect of clonal
origin's inference using simulation.
-> ClonalOrigin run is done in 1 day.
-> output/s13/run-analysis/s13-heatmap.txt
-> output/s13/run-analysis/s13-yes-heatmap.txt
-> output/s13/run-analysis/1.R.out shows that there are good agreements between
simulation and the true.
-> s10, s11, and s13 appear to show that simulations are okay.
-> Compare it with the real data analysis? output/s13/run-analysis/2.R.out

Thu Apr 28 14:14:00 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

I am trying to draft a manuscript.
--->

Wed Apr 27 10:34:40 EDT 2011
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The result of s10 shows that higher number of events tend to be underestimated.
Recombination events of 0 tend to be overestimated.

s11's analysis is being analyzed. Counting recombination events is slow: s11 is
1 repetition, 10 replicates with 100 blocks. Each replicate has 101 iterations.
-> done in 2 days (5 nodes) -> see the result
output/s11/run-analysis/1.R.out

s12 is executed in CAC. Actual count of recombinant edges comparison.
-> done in 2 days (5 nodes) -> The experiment may be flawed
-> output/s12/run-analysis/1.R.out
-> Underestimated (SPY <-> SDE, or 4,5,13,14,28,29,37,38)

output/cornellf/8/run-clonalorigin/output2/2 is executed. 
Burnin/ChainLength/Thin are 10,000,000/100,000,000/100,000. 
A previous run is saved as
cornellf/8/run-clonalorigin/output2/2a. The previous run of 2a was executed with
Burnin/ChainLength/Thin were 1,000,000/10,000,000/100,000. It took less than a
day.
-> done in 2 days (3 nodes) -> three analyses 
1) Heat map of recombination event
output/cornellf/8/run-analysis/heatmap-recedge-2.txt 
2) Recombination intensity is not done yet.
---> output/cornellf/8/run-analysis/recombination-intensity-2.txt
3) Recombination intensity2 is not done yet.
--->

cornellf/3/run-clonalorigin/output2/1 is executed.
Burnin/ChainLength/Thin are 10,000,000/100,000,000/100,000.
A previous run is saved as
cornellf/3/run-clonalorigin/output2/1a. The previous run of 1a was executed with
Burnin/ChainLength/Thin were 1,000,000/10,000,000/100,000. It took less than a
day.
-> done roughly in 7 days (7 nodes)
0) Prior expected number of recombinant edges:
output/cornellf/3/run-clonalorigin/output2/priorcount-1
1) Heat map of recombination event
output/cornellf/3/run-analysis/heatmap-recedge-1.txt 
2) Recombination intensity
by recombination-intensity.sh 
-> output/cornellf/3/run-analysis/recombination-intensity-1.txt
3) Recombination intensity2 is not done yet.
--->

The main analyses should be recoded: counting recombination events, measure of
recombination intensity (or probability of experiencing recombination events),
and gene ontology analysis with recombination intensity measure for genes.
Matt suggested that probability that a gene experiences recombination is the
proportion of total iterations where the gene is affected by any recombinant
edge. I am trying to code this one.
-> counting recombination events
-> measure of recombination intensity
--->

I am starting to write a manual for this mauve-analysis.


s10
---
I wish to check if clonal origin can recover the number of recombination events.
A single repetition with a single block is performed. 100 replicates are used.

s11
---
I wish to check if clonal origin can recover the number of recombination events.
A single repetition with multiple blocks is performed. 10 replicates are used
because the number of blocks can be large. The number of blocks is 100.


Current analysis
----------------
s9 is done
cornellf/2/run-clonalorigin/output/1 not done yet.


repetition 8 - replicate 2 
s7

cornellf's repetition 8 (5000 minimum) is considered. 

I am running this repetition 8 on the cluster. 
I want to know what is the difference from the 411 cluster and 71 cluster.
Median theta: 0.0749323036174269
Median delta: 614.149554455445
Median rho: 0.0137842770601471

Interestingly I have the following values from 415-block analysis. It seems that
the chain length of the previous one was too short. I may have to try the limit
of 1000. This is Repetition 2.
Median theta:0.0805492163856909
Median delta:795.814391608391
Median rho:0.0104334916432993

cornellf/2/run-clonalorigin/output/1
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ClonalFrameREPLICATE:1
REPLICATE:1
ClonalFrame Tree:1
-x 1,000,000 -y 10,000,000 -z 100,000
Not done yet.

cornellf/3/run-clonalorigin/output/1
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1) bacillus    4) s1         7) s4        10) s7        13) test
2) cornell5    5) s2         8) s5        11) s8
3) cornellf    6) s3         9) s6        12) s9
Choose the species to analyze with clonalorigin: 3
What repetition do you wish to run? (e.g., 1) 3
Which replicate set of ClonalFrame output files?
ClonalFrame REPLICATE ID: 1
Which replicate set of ClonalOrigin output files?
ClonalOrigin REPLICATE ID: 1
Which clonal frame is used for a phylogeny? (e.g., 1) 1
-x 1,000,000 -y 10,000,000 -z 100,000


Directories
-----------

simulation
~~~~~~~~~~
Simulation setups are stored in this directory.

species
~~~~~~~
This directory contains text files, each of which describes a data set and
the purpose of analysis of thereof. 

output
~~~~~~
This directory contains subdirectories with the same names as those in the main
directory called +species+. A subdirectory contains more directories with
positive integer numbers.

Bacteria species under study
----------------------------

bacillus
~~~~~~~~
A smaller data set seems to work with ClonalFrame.
I stopped at ClonalFrame's analysis with a smaller dataset.
I think that the running option that I use ClonalFrame seems okay.

Staphylococcus aureus
~~~~~~~~~~~~~~~~~~~~~
This should be analyzed similarly to that of B. cereus because recombination
rates seem comparable to those of B. cereus. The number of species is also
comparable.

Staphylococcus
~~~~~~~~~~~~~~
I want to test the hypothesis that is depicted by Figure 16.4 of the bacterial
population genetics book. See the page at 335 of the book.
Evolutionary scenario of S. epidermidis and S. aureus.
S. epidermidis has higher recombation rates than S. aureus. 
Did their most recent common ancestor have high recombination rates as S.
epidermidis?  Or, did it have low recombination rates as S. aureus?
There are 6 more genomes that are in Staphylococcus genus. These genomes should
inform us of the state of the ancestor of S. epidermidis and S. aureus.
I want to find one outgroup first.

Sulfolobus_islandicus
---------------------
There are 7 genomes.
Mauve alignment: PASS!
ClonalFrame (small): PASS!
ClonalOrigin: in progress...
This may be the first example that I can analyze with ClonalFrame and
ClonalOrigin.  

Sulfolobus
----------
Four more members of Sulfolobales are added.
There are 11 genome members of Sulfolobales.
Horizontal gene transfer can be studied using Clonal Origin.
Their timing can be summarized.
This data set of 11 genomes may not have a single species tree.

Sulfolobus8
-----------
We remove three genomes leaving 8 genomes.
We might study when genomic segments migrated between the 8-th genomes and each
of the 7 S. islandicus genomes.
I am interested in gene flow between the outgroup and the 7 ingroup genomes.
I ran 2 sets of jobs, and each with 3 independent runs of 5,000 and 10,000 (?):.
Two out of three are similar and one of them has longer branch lengths.
MC3 may be necessary.  We might try more chains not 3.

cornell6
--------
In addition to the 5 genomes from cornell, S. canis is also added.
3 blocks are removed because their alignments do have too much deletions. Some
alignments have large partial one side flanking gaps.
1:17740
1:160477
4:1720750

cornellf
--------
Somehow I got wrong version of SDE1 and SDD genomes. I asked Haruo for the
version that he had. This cornellf means the final version of cornell5. The
older version and the new one of SDE1 seem to be almost the same. SDD's genomes
are somewhat different, but not much.

Repetition 1: The 411 blocks that are filtered using 500 base pairs minimum.

Repetition 2
~~~~~~~~~~~~
I use 1000 base pairs minimum for the filtering.

The filtering of 1000 minimum length yields 341 blocks.  I removed 3 blocks with
large gaps, which yields 338.

Repetition 3
~~~~~~~~~~~~
I use 1500 base pairs minimum for the filtering. I removed 2 blocks with large
gaps (blocks with consecutive gaps of size larger than 50).

Repetition 4
~~~~~~~~~~~~
I use 2000 base pairs minimum for the filtering. I removed 2 blocks with large
gaps (blocks with consecutive gaps of size larger than 50).

Repetition 5
~~~~~~~~~~~~
I use 2500 base pairs minimum for the filtering. I removed 1 block with large
gaps (blocks with consecutive gaps of size larger than 50).

Repetition 6
~~~~~~~~~~~~
I use 3000 base pairs minimum for the filtering. I removed 1 block with large
gaps (blocks with consecutive gaps of size larger than 50).

Repetition 7
~~~~~~~~~~~~
I use 4000 base pairs minimum for the filtering. I removed 1 block with large
gaps (blocks with consecutive gaps of size larger than 50).

Repetition 8
~~~~~~~~~~~~
I use 5000 base pairs minimum for the filtering. I removed no block with large
gaps (blocks with consecutive gaps of size larger than 50).

simulation
----------

s1: 1 block of 10,000 base pairs (100 times) -> Okay!
s3: 10 blocks of 10000 base pairs (5 times) -> Not okay
s5: 10 blocks of 10000 base pairs (50 times) -> Seems okay! 
-> s3's result is due to smaller repetitions.
s6: 100 blocks of 10000 base pairs (5 times) -> Seems okay, too!

s2: Real data - 500 minimum block
s4: Real data - 4000 base pairs of minimum block (2 times)

# s8: 1 block - 10k base pairs (100 times) -> wrong simulation
# s9: 100 blocks - 10k base pairs (5 times) -> wrong simulation

s10: 1 block with the same recombinant edges - 10k base pairs (100 replicates)
s11: 100-block with a single recombinant tree - (10 replicates)
# s12: what is flawed in s12? See above.
# s13: s14 replaces s13 by increasing the number of repetition.
s14: 71-block with 10 recombinant trees (10 replicates for each recombinant tree

s15: The 1st stage of ClonalOrigin with block configuration of 274 blocks of
cornellf/3, 10 REPETITION

cornell5
--------
SEE is removed from the analysis of cornell6 because a whole genome may be
enough to root the tree, and the outgroup of SEE may not be necessary.
Two of three ClonalFrame runs seems concordant.  I proceed with the first stage
of ClonalOrigin analysis.
Several blocks need more computing time than many others.

ClonalFrame's analyses 1 and 2 are similar.  Replicate 1 uses the 2nd one, and
replicate 2 uses the 1st one.  The 0-th ClonalFrame analysis is not similar to
those, and it is not used.

Among 419 blocks 3 blocks are removed and the data set consists of 416 blocks.
The removed blocks have weird gaps: 67,82,153,293 are moved. 
67 and 82 do not have gaps but its takes too much time to run them with 
clonal origin probably due to very large number of recedges.

In the second runs of clonalframe, I have multiple trees. The tree (A) that I used
before apprears in 3 out of 7. One tree with higher likelihood appears, and this
is problematic. Since I have to assess the convergence issue of 1st
ClonalOrigin and the tree A appears to make sense, I use one of the tree say,
ClonalFrame RUNID of 1 to proceed to ClonalOrigin analysis.

RUNID=5 Note that this is the run id of ClonalFrame runs.

CLONALFRAMEREPLICATE=2 Note that this replicate is one for run-clonalframe not
run-clonalorigin.

REPLICATE=1 This is the replicate number for run-clonalorigin.

67,82,153,293 are removed from 419.
121,160,203,247 will be removed from 415 because 160's log-likelihood does not
seem to converge. 121,203,247 takes too much time to finish.
What are those that are removed from 419?
Multiple 2's, 160's and 236's are running run-clonalorigin5 at 6.

67  82       153                 293 among 419.
        121       160  203  247      among 415.
67  82  123  153  163  206  250  293 among 419 ?
67,82,123,153,163,206,250,293
were filtered out.

0.0542/1425/0.00521 are used for 2nd clonal origin analysis.

run-analysis
~~~~~~~~~~~~
NC_004070.gff

I downloaded bcp_go_role_link and bcp_role_link at
ftp://ftp.jcvi.org//pub/data/Omniome_Database/tab_delimited_omniome

I downloaded loci information of MGAS315 at
http://cmr.jcvi.org
as files
bcp_m3_jcvi_locus.txt
and 
bcp_m3_primary_locus.txt.

I compare bcp_m3_jcvi_locus.txt with bcp_m3_primary_locus.txt to find one-to-one
associations between primary locus (Genbank locus_tag) and JCVI locus. I use
bcp_go_role_link to find gene ontology annotations for the JCVI loci. The
one-to-one associations are used to assign primary loci with their gene ontology
annotations. What is bcp_role_link?

I can list roles at
http://cmr.jcvi.org/cgi-bin/CMR/shared/RoleList.cgi

Where are links between role id and these role categories?
I found a web site at
http://cmr.jcvi.org/cgi-bin/CMR/shared/RoleList.cgi
and saved it as a source file named jcvi_role.html.
I parse jcvi_role.html to find the assignment role IDs of JCVI role category
lists.

For JCVI roles I can group locus tags by main roles or submain roles using the
numbers.  For gene ontologies I should be able to test if a gene ontology
category of a locus tag belongs to a main gene ontology category; say metabolism
within a cellular process.  There is a slim gene ontology as far as I know. The
slim gene ontology should contain most gene ontology categories and it can be
used to test a gene ontology category's membership in the gene ontology. There
must be a PERL script to test that. Let me find the PERL script and the slim
gene ontology file. Note that one locus tag can belong to multiple functional
categories.


spyogenes
---------
I used 13 genomes. Two runs did not converge. Clonal frame is hard to obtain.
One of two runs seems stucked at a tree, and mixing was bad.
One of the runs runs okay. This is encouraging (Note the spyogenes6 did not
work, or R value increases to reach a plateau. 

An EPS formatted figure is generated by FigTree.
$ convert figure1.eps figure2.eps
to add it to the asciidoc text file.


spyogenes6
-----------
Each of three pairs of genomes are from the same M type. I remove one of each
pair. I also remove some to make a set of 6 species. The idea is if MCMC chains
converge and mix with a smaller number of species.
I see a similar problem: R value increases to reach a plateau.
I turn to cornell5 data set.

Burkholderia_cenocepacia
------------------------
This archea species include 4 genomes. Interestingly each genome consists of
multiple circular chromosomes or 3 chromosome. I combine the multiple
chromosomes to a single one. This can serve as a genome for ClonalFrame
analysis.
The analysis of archea may be interesting.

The genomes 1 and 2 are almost the same.
[literal]
cat ~/Elements/Documents/Projects/mauve/bacteria/Burkholderia_cenocepacia_MC0_3_uid58769/*.gbk > 1.gbk
union -sequence 1.gbk -sformat genbank -outseq 2.gbk -osformat genbank -feature Y -auto
mv 2.gbk Burkholderia_cenocepacia_MC0_3.gbk
rm 1.gbk

The clonalframe analysis did not work with walltime of 268 hours.
I should work on it with larger walltime.


Salmonella_enterica
-------------------
I do not know what brought me to analyze this.
smaller clonal frame was finished.
The 16 genome data set clonalframe analysis failed to converge. I remove 4 of
them to have 12 genomes.  I stop this analysis until I know what I should do.
Obviously, I have to restart from 12 genome alignment using mauve.

cornell6
--------

union -sequence SCAZ3_08042009.gbf -sformat genbank -outseq sca.gbk -osformat genbank -feature Y -auto

Command Lines
-------------

To find genomes of a species
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[literal]
cd /Users/goshng/Elements/Documents/Projects/mauve/bacteria
[literal]
ls -l `find . -name *.gbk`| grep Staphylococcus_aureus > ~/Documents/Projects/mauve/species/Staphylococcus_aureus

To create a genome analysis
~~~~~~~~~~~~~~~~~~~~~~~~~~~
[literal]
bash sh/run.sh leptospira



Directories
-----------

cac
~~~
Examples of batch scripts for submitting jobs to CAC cluster.

streptococcus
~~~~~~~~~~~~~
Fourteen genomes are collated for a mauve analysis.

Problems
--------
ClonalFrame seems slow with increase in number of blocks.
Bacillus data set is hard to analyze with ClonalFrame. 
Streptococcus data set is smaller than Bacillus data set in size. 

streptococcus
~~~~~~~~~~~~~
N=14, b=471, L=603426
means that 14 genomes share 471 blocks that combine to be 603,426 in characters.
It would take about a week to run 20,000 generations of MCMC.

bacillus
~~~~~~~~
N=13, b=1200, L=3596990
means that 13 genomes share 1,200 blocks that combine to be 3,596,990 in
characters. This would take 8 days (or more than a week) to run 8,000
generations of MCMC.

External Programs
-----------------
Some perl scripts and c++ source files are prepared for helping mauve analyses.
- blocksplit2fasta.pl: A perl script that splits a core alignment to multiple
  fasta files. These fasta files are taken as input to
  compute_watterson_estimate to compute Watterson's estimate.
- blocksplit2smallerfasta.pl: A perl script that subsample blocks from a core
  alignment. 
- compute_watterson_estimate: A c++ source file that computes Watterson's
  estimates of DNA sequence alignments.
[literal]
/Users/goshng/Documents/Projects/biopp/bpp-test/compute_watterson_estimate.cpp
- Convert core to smaller core.
[literal]
usr/bin/core2smallercore.pl

- To find per-site mutation rate, recombination rate, and track length (1st
  ClonalOrigin):
[literal]
usr/bin/extractClonalOriginParameter.pl

- To summarize recedges (2nd ClonalOrigin):
[literal]
usr/bin/extractClonalOriginParameter2.pl

- To generate trace plot of mutation rate, recombination rate, and track length
  (1st ClonalOrigin):
[literal]
usr/bin/extractClonalOriginParameter3.pl

Useful Bash Script
------------------
- To cancel multiple CAC jobs:
[literal]
for i in {1..15}; do mjobctl -c 1074682-$i; done
[literal]
for i in {1..419}; do tail -v -n 1 output/core_co.phase2.$i.xml >> 1; done

- To list iteration numbers for all the jobs:
[literal]
for i in {1..120}; do grep --with-filename number core_co.phase3.$i.xml | tail -n 1; done | less

Two jobs were not finished in the 1st stage of ClonalOrigin
-----------------------------------------------------------
core_co.phase2.293.xml
core_co.phase2.67.xml

Summarization of ClonalOrigin
-----------------------------
Recedge by recedge I count the import source.  Then divide those values by the
number of sample sizes.

How to plot a EPS figure?

Checks
------
. Count remaining jobs when the total length of a chain is 2000000:
[literal]
grep "<number>2000001" output/2/* | wc
[literal]
for i in {1..419}; do grep --with-filename "<number>" output/2/core_co.phase2.$i.xml | tail -n 1; done | grep -v 2000001 | wc

To Do
-----
Change the following code to generate some figures for recombinant edges given a
clonal frame and a genome. We need a reference genome. I think that the first
SDE1 can be a reference genome.
The length of a block can be found XML tag <Blocks>. The start and end positions
of a block along the genome SDE1 can be found the block of alignment: e.g.,
core_alignment.xmfa.55.  The first sequence has the start and end position.
Note that the block length should be equal to the sum of abs(start - end) + 1 +
number of gaps in the alignment. The start and end positions are inclusive.
[literal]
usr/bin/extractClonalOriginParameter2.pl

Check REPLICATE bash variable in run.sh.

I should compare 2 replicates of the first stages of clonal origin MCMC.

gff
---
The following lines should be in the gff file. Then IGB can display names.

##gff-version 3
#!gff-spec-version 1.14
#!source-version NCBI C++ formatter 0.2
##Type DNA NC_0004070.1

Long Jobs
---------
cornell5
~~~~~~~~
67 and 293


CMake
-----
cd /Users/goshng/Documents/Projects/Mauve/src/clonalorigin
mkdir b
cd b
cmake -DCMAKE_CXX_FLAGS="-g3 -ggdb -O0" ..
make

GDB with C++
------------
.To check the content of a vector
print *(blocks._M_impl._M_start)@blocks.size()

.To iterate the content of a vector
for (unsigned i = 0; i < blocks.size(); i++) {
  cout << "[" << i << "] " << blocks[i];
}

The latest commands
-------------------
for i in {1..18}; do mjobctl -c 1081180-$i; done

About simulation
----------------
I simulate the clonal origin model to generate sequence data. By product I would
have a clonal frame with recombinant edges. I can use multiply repeated
sequence data to recover mutation rate, recombination rate, recombinant tract
length. I cannot recover recombinant edges because the recombinant edges are one
realization of the model. This is like attempting to recover a data set, which
is also one realization. I need to generate multiple data from a clonal
frame with a single set of recombinant edges. This requires changing weakargsim
code.

Given a species tree, and the true values of the 3 main parameters.
1. The number of recombinant edges.
2. Heat map analysis.
3. Recombination intensity.

Manuscript
----------

.Source codes and input data sets
----
http://code.google.com/p/mauve-analysis/
----

.Figure 1 Species tree
----
manuscript/species.tre
output/cornellf/3/run-clonalorigin/input/1/clonaltree.nwk
(((1:0.045557,2:0.045557)6:0.195330,3:0.240887)8:0.089874,(4:0.074544,5:0.074544)7:0.256218)9:0.000000
----

.Figure 2A
----
output/cornellf/3/run-analysis/heatmap-recedge-1.txt
output/cornellf/3/run-analysis/heatmap-recedge.R
output/cornellf/3/run-analysis/heatmap-recedge.R.out
/Users/goshng/Documents/Projects/Mauve/output/s18/run-analysis/a
----

.Figure 2B
----
output/cornellf/3/run-analysis/heatmap-hgtedge-norm.R
output/cornellf/3/run-analysis/heatmap-hgtedge-norm.R.ps
output/cornellf/3/run-analysis/hgt-norm-sig.txt
----

.Figure 3
----
From Matt's.
----

.Table S1 The six complete bacterial genomes
----
input
----

.Table S2
----
output/cornellf/3/run-clonalorigin/summary/1/median.txt
output/cornellf/3/run-clonalorigin/summary/2/median.txt
----

.Family size figures
----
/test/famsizes/famsizes.R
----

.Statistics of 274 blocks, length of the blocks, total number of genes, and
genes covered by blocks.
----
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/run.log
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/in.gene
/Users/goshng/Documents/Projects/Mauve/output/cornellf/3/run-analysis/in.gene.4.block
----
Average proportion of gaps in genes was found in.gene.4.block.

.Heat map of horizontal gene transfer (hgt)
----
output/cornellf/3/run-analysis/heatmap-hgtedge.R
output/cornellf/3/run-analysis/heatmap-hgtedge.R.ps
output/cornellf/3/run-analysis/heatmap-hgtedge.txt
output/cornellf/3/run-analysis/heatmap-recedge-mowgli.txt
output/cornellf/3/run-analysis/heatmap-recedge-mowgli.R.ps

Export mauve-analysis.key to tiff or image.
tiff2ps mauve-analysis.001.tiff > mauve-analysis-001.ps
open mauve-analysis-001.ps (with Preview and save it as a PDF)
----

.Scatter plot of rho and log(delta)
----
output/cornellf/3/run-analysis/scatter-plot-parameter-1-out2.R
output/cornellf/3/run-analysis/rho-vs-delta.pdf
output/cornellf/3/run-analysis/rho-vs-delta.ps
----

.Multiple alignment using Mauve
----
output/cornellf/3/run-analysis/run.log
----

.ClonalFrame Analysis
----
output/cornellf/3/run-clonalframe/output/1/core_clonalframe.out.1
swiftgen:/home/choi/Documents/Projects/m2/output/cornellf/3/run-clonalframe/core_clonalframe.out.1
----


.ClonalOrigin's 1st stage results
----
output/cornellf/3/run-clonalorigin/summary/1/median.txt
----

.Heatmap of number of recombination
----
output/cornellf/3/run-analysis/heatmap-recedge.R.out
Note that the order is 
"SDE1", "SDE", "SDE2", "SD", "SDD", "ROOT", "SPY1", "SPY", "SPY2"
output/cornellf/3/run-analysis/heatmap-recedge.R
output/cornellf/3/run-analysis/heatmap-recedge-1.txt
output/cornellf/3/run-analysis/obsonly-recedge-1.txt
output/cornellf/3/run-analysis/strep/051211/heatmap-recedge.ps
----

.Scatter plots of the three parameters
----
output/cornellf/3/run-analysis/scatter-plot-parameter-1-out-theta
output/cornellf/3/run-analysis/scatter-plot-parameter-1-out-rho
output/cornellf/3/run-analysis/scatter-plot-parameter-1-out-delta
----

.SVN version of the initial check in of the manuscript
r3988

http://compgen.bscb.cornell.edu/wiki/index.php/Subversion_repository


.Simulation
----
perl pl/simulate-data-clonalorigin1-analyze.pl -in output/s15/run-analysis/out -numbersample 101 -out 1
output/s15/run-analysis/out.summary
----


.cornellf/3 summary of three parameters (in manuscript)
----
Median theta:0.080814517322956
Median Q1 theta:0.0674683150905946
Median Q3 theta:0.0944751655370584
Median delta:743.702415841584
Median Q1 delta:345.770247524752
Median Q3 delta:2848.03306930693
Median rho:0.0118491287894766
Median Q1 rho:0.00571541439036853
Median Q3 rho:0.0193800640707135
----

.RI1 for the reference genomes of SPY1
----
output/cornellf/3/run-analysis/ri1-refgenome4-map.gene
----

.RI2
----
/Users/goshng/Documents/Projects/mauve-analysis/output/cornellf/3/run-analysis/in.gene
----

.RI1 simulation result
----
output/s16/run-analysis/ri.R.ps
----

.Heatmap simulation between true and simulated
----
h1-R-inset.ps
h1-R.ps
----

.Heatmap simulation between real and simulated
----
h2-R-inset.ps
h2-R-inset2.ps
h2-R.ps
----

ri-R.ps
----
http://strep-genome.bscb.cornell.edu/cgi-bin/hgTracks?db=SpyMGAS315&position=chr1&hgt.customText=http://compgen.bscb.cornell.edu/~choi/ri1-refgenome4-map.wig
http://strep-genome.bscb.cornell.edu/cgi-bin/hgTracks?db=SmuUA159&position=chr1&hgt.customText=http://compgen.bscb.cornell.edu/~choi/SRR031130.pm.wig
----

